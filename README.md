# 履修最適化ツール (Course Registration Optimizer)

## 概要

このツールは、大学の授業データ（CSV）を元に、ユーザーが設定した制約（必修科目、単位数、空きコマなど）に基づいて最適な履修計画の候補を複数生成するコマンドラインツールです。
※現在ICUのみ対応しています

## 主な機能

- **データ整形**: 元の時間割CSVファイルを整形し、プログラムで扱いやすい形式に変換します。
- **パターン抽出**: 全ての授業から共通する時間割のパターンを自動で抽出し、最適化処理のベースとして使用します。
- **柔軟な制約設定**: `user_settings.json` ファイルを通じて、履修計画に関する様々な制約を細かく設定できます。
- **複数候補の提示**: 設定された制約に基づき、複数の最適な時間割候補をスコアリングして提示します。
- **代替科目の提案**: 履修候補の各科目について、入れ替え可能な他の選択肢をリストアップします。

## ファイル構成

```
.
├── 2025W - Sheet1.csv       # (入力) 大学から提供された元の授業データ(リモートリポジトリには追加していません)
├── 2025W_normalized.csv     # (生成) 整形済みの授業データ
├── schedule_patterns.json   # (生成) 抽出された時間割パターン
├── user_settings.json       # (入力) ユーザーが設定する制約ファイル
├── normalize_courses.py     # (実行) データ整形スクリプト
├── discover_patterns.py     # (実行) 時間割パターン抽出スクリプト
├── optimize_courses.py      # (実行) 履修最適化メインスクリプト
└── README.md                # このファイル
```

## 実行方法

### 1. 準備

1.  `2025W - Sheet1.csv` のような、大学から提供された生の授業データをこのフォルダに配置します。
2.  `user_settings.json` を開き、自分の希望に合わせて履修の制約を編集します。詳細は後述の「設定ファイル (`user_settings.json`) の説明」を参照してください。

### 2. データ整形とパターン抽出

以下のコマンドを順番に実行します。これにより、最適化の実行に必要な前処理が行われます。

```bash
# 1. 元のCSVファイルを整形する
python normalize_courses.py

# 2. 整形されたデータから時間割パターンを抽出する
python discover_patterns.py
```

### 3. 最適化の実行

以下のコマンドで、設定に基づいて最適な時間割の候補を生成します。

```bash
python optimize_courses.py
```

結果がターミナルに出力されます。

## 設定ファイル (`user_settings.json`) の説明

このファイルで、履修計画のルールを細かく指定します。

-   `constraints`: 履修の基本的な制約
    -   `mandatory_nos`: 必ず履修したい科目のコース番号（例: `["MTH101", "PHY101"]`）。
    -   `excluded_nos`: 履修対象から除外したい科目のコース番号や、科目コードのプレフィックス（例: `["HPE", "JLP1"]`）。
    -   `desired_nos`: 必修ではないが、優先的に履修したい科目のコース番号。
    -   `min_credits`, `max_credits`: 履修する合計単位数の下限と上限。
    -   `off_days`: 全休にしたい曜日のリスト（例: `["水", "金"]`）。
    -   `unavailable_slots`: 授業を入れたくない時間帯のリスト。曜（`day`）と時限（`period`）で指定します。
-   `optimizer_settings`: 最適化アルゴリズムの挙動を調整する設定
    -   `priority_subjects`: 優先的に選択したい科目のプレフィックス（例: `["PHY"]`）。
    -   `level_priorities`: 特定の科目コードについて、優先したいレベル（番台）を指定します（例: `{"MTH": 200}` は `MTH2xx` の科目を優先）。
    -   `temperature`: 候補選択のランダム性（0〜100）。0に近いほど`desired_nos`やスコアの高い科目を厳密に選び、100に近いほどランダムに選びます。
    -   `max_candidates`: 生成する時間割候補の最大数。
    -   `course_level_constraints`: 専門科目やその他の科目について、履修するレベル（番台）の範囲を制限します。
        -   `major_subjects`: `codes`で指定した専門科目の`min_level`と`max_level`を設定。
        -   `other_subjects`: それ以外の科目のレベル範囲を設定。
